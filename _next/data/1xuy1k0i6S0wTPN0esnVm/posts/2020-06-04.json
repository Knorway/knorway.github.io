{"pageProps":{"data":{"title":"Next.js useRouter의 router.query는 undefined를 뱉을 수 있다","publishedAt":"2020-06-04","tags":"Next","summary":"이 단순한 fetcher는 가끔 /users/undefined로 404가 뜰 수 있다 정적으로 최적화 된 페이지는 경로 파라미터..."},"content":"\n```javascript\nconst { uuid } = router.query\nconst { data } = useSWR(\n\t\t`${API_URL}/users/${uuid}`,\n\t\tasync (url) => {\n\t\t\tconst response = await client.get(url, { headers: BearerHeader() });\n\t\t\treturn response.data;\n\t\t},\n\t\t{ revalidateOnFocus: false }\n\t);\n```\n이 단순한 fetcher는 가끔 /users/undefined로 404가 뜰 수 있다. 정적으로 최적화 된 페이지는\n경로 파라미터 없이 제공되고 Hydrate 이후 Next.js가 query 객체를 채우게 되기 때문이다.\n\n<br />\n\n이를 해결하는 가장 일반적인 방법은 아래와 같을 것이고\n```javascript\nuseEffect(()=>{\n    if(!router.isReady) return;\n    // router.query를 사용하는 로직\n\n}, [router.isReady]);\n```\n\n<br />\n\n위와 같이 useSWR을 사용하는 경우는\n```javascript\nif (!uuid) return;\nconst response = await client.get(url, { headers: BearerHeader() });\n```\n이렇게 한 줄 더 넣어주자.\nreturn; 은 undefined를 리턴하게 되고 useSWR은 넘겨진 콜백함수의 페처가 유의미한 값,\n즉 데이터나 프로미스 오류를 반환하게 되기 전까지 요청을 수행하게 된다.\n아마 이런식으로 useEffect처럼 작동하는 것이 아닐까 생각한다.\n참고로 이런 이유로 mutate를 사용해 캐시를 초기화 하고 싶다면 명시적인 값이나 null을 넣어주어야지 undefined가 반환되면 그대로 유지된다."},"__N_SSG":true}